"use strict";(self.webpackChunkbywater_blog=self.webpackChunkbywater_blog||[]).push([[2399],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),d=o,f=p["".concat(i,".").concat(d)]||p[d]||m[d]||r;return n?a.createElement(f,l(l({ref:t},u),{},{components:n})):a.createElement(f,l({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,l=new Array(r);l[0]=p;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,l[1]=s;for(var c=2;c<r;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},8051:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const r={sidebar_position:24},l="[\u9435\u4eba\u8cfd 2022-\u64ca\u6557\u524d\u7aef\u9762\u8a66\u5927\u4f5c\u6230] \u4e09\u4eba\u884c\u5fc5\u6709\u6211\u5e2b\u7109 ---- useMemo vs React.memo vs useCallback \u4e09\u7a2e\u512a\u5316 React \u7684\u65b9\u6cd5\uff01",s={unversionedId:"ironMan2022/reactOptimization",id:"ironMan2022/reactOptimization",title:"[\u9435\u4eba\u8cfd 2022-\u64ca\u6557\u524d\u7aef\u9762\u8a66\u5927\u4f5c\u6230] \u4e09\u4eba\u884c\u5fc5\u6709\u6211\u5e2b\u7109 ---- useMemo vs React.memo vs useCallback \u4e09\u7a2e\u512a\u5316 React \u7684\u65b9\u6cd5\uff01",description:"\u9019\u7bc7\u662f\u512a\u5316\u7684\u6700\u5f8c\u4e00\u7bc7\u6587\u7ae0\uff0c\u8981\u4f86\u8a0e\u8ad6\u512a\u5316 React \u7684\u4e09\u7a2e\u65b9\u6cd5\uff0c\u5206\u5225\u662f useMemo, React.memo \u548c useCallback!",source:"@site/docs/ironMan2022/reactOptimization.md",sourceDirName:"ironMan2022",slug:"/ironMan2022/reactOptimization",permalink:"/bywater-blog/ironMan2022/reactOptimization",draft:!1,tags:[],version:"current",sidebarPosition:24,frontMatter:{sidebar_position:24},sidebar:"tutorialSidebar",previous:{title:"[\u9435\u4eba\u8cfd 2022-\u64ca\u6557\u524d\u7aef\u9762\u8a66\u5927\u4f5c\u6230] client-side-rendering vs server-side-rendering",permalink:"/bywater-blog/ironMan2022/CSR"},next:{title:"[\u9435\u4eba\u8cfd 2022-\u64ca\u6557\u524d\u7aef\u9762\u8a66\u5927\u4f5c\u6230] HTTP trivia",permalink:"/bywater-blog/ironMan2022/htmlTrivia"}},i={},c=[{value:"useMemo vs React.memo vs useCallback",id:"usememo-vs-reactmemo-vs-usecallback",level:2},{value:"<code>useMemo</code>",id:"usememo",level:4},{value:"<code>React.Memo</code>",id:"reactmemo",level:4},{value:"<code>useCallback</code>",id:"usecallback",level:4},{value:"debounce",id:"debounce",level:3},{value:"throttle",id:"throttle",level:3}],u={toc:c};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\u9435\u4eba\u8cfd-2022-\u64ca\u6557\u524d\u7aef\u9762\u8a66\u5927\u4f5c\u6230-\u4e09\u4eba\u884c\u5fc5\u6709\u6211\u5e2b\u7109------usememo-vs-reactmemo-vs-usecallback-\u4e09\u7a2e\u512a\u5316-react-\u7684\u65b9\u6cd5"},"[\u9435\u4eba\u8cfd 2022-\u64ca\u6557\u524d\u7aef\u9762\u8a66\u5927\u4f5c\u6230]"," \u4e09\u4eba\u884c\u5fc5\u6709\u6211\u5e2b\u7109 ---- useMemo vs React.memo vs useCallback \u4e09\u7a2e\u512a\u5316 React \u7684\u65b9\u6cd5\uff01"),(0,o.kt)("p",null,"\u9019\u7bc7\u662f\u512a\u5316\u7684\u6700\u5f8c\u4e00\u7bc7\u6587\u7ae0\uff0c\u8981\u4f86\u8a0e\u8ad6\u512a\u5316 React \u7684\u4e09\u7a2e\u65b9\u6cd5\uff0c\u5206\u5225\u662f useMemo, React.memo \u548c useCallback!"),(0,o.kt)("h2",{id:"usememo-vs-reactmemo-vs-usecallback"},"useMemo vs React.memo vs useCallback"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR;")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useMemo"),"\u6703\u56de\u50b3\u4e00\u500b\u88ab memoized \u7684\u503c\u3002"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useCallback"),"\u6703\u56de\u50b3\u4e00\u500b\u88ab memoized \u7684 callback function."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"React.Memo"),"\u4e3b\u8981\u662f\u7528 shallow comparison \u4f86 memoize \u4e00\u500b ",(0,o.kt)("strong",{parentName:"li"},"component")," .")),(0,o.kt)("h4",{id:"usememo"},(0,o.kt)("inlineCode",{parentName:"h4"},"useMemo")),(0,o.kt)("p",null,"\u4e3b\u8981\u662f\u7528\u4f86 memoized",(0,o.kt)("strong",{parentName:"p"},"\u8a08\u7b97\u8907\u96dc\u3001\u8017\u8cbb\u6548\u80fd\u7684 function"),"\uff0c\u4e26\u4e14",(0,o.kt)("strong",{parentName:"p"},"\u56de\u50b3\u4e00\u500b\u503c")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const calculation = useMemo(() => expensiveCalculation(count), [count]);\n")),(0,o.kt)("p",null,"\u4ed6\u9577\u5f97\u8ddf useEffect \u5f88\u50cf\uff0c\u7528\u6cd5\u4e5f\u5f88\u985e\u4f3c\u3002\u53ea\u6709\u5728\u7b2c\u4e8c\u500b\u503c(\u5728\u9019\u88e1\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"count"),")\u88ab\u6539\u8b8a\u6642\uff0c\u6574\u500b function \u624d\u6703\u57f7\u884c\u3002"),(0,o.kt)("p",null,"\u4ec0\u9ebc\u6642\u5019\u8a72\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo"),"?"),(0,o.kt)("p",null,"\u5b98\u7db2\u7684\u89e3\u91cb\u662f\u9019\u6a23\uff1a"),(0,o.kt)("p",null,"In general, unless you\u2019re creating or looping over thousands of objects, it\u2019s probably not expensive. If you want to get more confidence, you can add a console log to measure the time spent in a piece of code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.time("filter array");\nconst visibleTodos = getFilteredTodos(todos, filter);\nconsole.timeEnd("filter array");\n')),(0,o.kt)("p",null,"Perform the interaction you\u2019re measuring (for example, typing into the input). You will then see logs like filter array: 0.15ms in your console. If the overall logged time adds up to a significant amount (say, 1ms or more), it might make sense to memoize that calculation. As an experiment, you can then wrap the calculation in useMemo to verify whether the total logged time has decreased for that interaction or not:"),(0,o.kt)("h4",{id:"reactmemo"},(0,o.kt)("inlineCode",{parentName:"h4"},"React.Memo")),(0,o.kt)("p",null,"\u7b2c\u4e8c\u500b React.Memo \u4ed6\u662f\u7528\u5728 memoized",(0,o.kt)("strong",{parentName:"p"},"React component"),"\uff0c\u5982\u679c\u50b3\u9032\u8a72 component \u7684 props \u6c92\u6709\u6539\u8b8a\uff0c\u90a3\u8a72 component \u5c31\u4e0d\u6703 re-render\u3002",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("strong",{parentName:"p"},"\u6ce8\u610f: React.Memo \u4f7f\u7528\u7684\u662f shallow comparison\uff0c\u6240\u4ee5\u5982\u679c\u50b3\u9032\u53bb\u7684 props \u662f\u7269\u4ef6\u7684\u8a71\u662f\u6c92\u6709\u7528\u7684")),(0,o.kt)("p",null,"\u90a3\u5047\u5982\u6211\u5011\u9084\u662f\u60f3\u50b3 object props \u9032\u53bb\u600e\u9ebc\u8fa6\u5462\uff1f\u6709\u5169\u7a2e\u65b9\u6cd5\u53ef\u4ee5\u505a\u5230\uff01\u7b2c\u4e00\u7a2e\u662f\u5047\u8a2d\u50b3\u9032\u4f86\u7684 props \u662f function \u7684\u6642\u5019\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u6703\u8b1b\u7684 useCallback \u628a\u8a72 function \u7d66\u5305\u4f4f\uff0c\u7b2c\u4e8c\u7a2e\u5247\u662f\u7528 React.memo \u6240\u63d0\u4f9b\u7684\u7b2c\u4e8c\u500b params \u4f86\u8655\u7406\uff0cReact.memo \u7684\u7b2c\u4e8c\u500b params \u662f\u4e00\u500b compare function\uff0c\u8b93\u6211\u5011\u53ef\u4ee5\u81ea\u884c\u53bb\u5beb\u6bd4\u8f03\u7684\u65b9\u6cd5\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function MyComponent(props) {\n  /* render using props */\n}\n\nfunction areEqual(prevProps, nextProps) {\n  /*\n  return true if passing nextProps to render would return\n  the same result as passing prevProps to render,\n  otherwise return false\n  */\n}\n\nexport default React.memo(MyComponent, areEqual);\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//\u7bc4\u4f8b\nconst areEqual = (prevProps, nextProps) =>\n  JSON.stringify(prevProps) === JSON.stringfiy(nextProps);\nexport default React.memo(renderedTable, areEqual);\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6839\u64da",(0,o.kt)("a",{parentName:"strong",href:"https://overreacted.io/before-you-memo/"},"dan \u5927\u795e\u7684\u9019\u7bc7\u6587\u7ae0"),"\uff0c\u4ed6\u5efa\u8b70\u5728\u4f7f\u7528 memo \u4e4b\u524d\uff0c\u8a66\u8a66\u770b\u5148\u628a state \u63d0\u5347\u5230\u4e0a\u4e00\u5c64\u6216\u662f\u4e0b\u653e\u5230\u4e0b\u4e00\u5c64\u88e1\u9762\uff0c\u6216\u662f\u53ef\u4ee5\u628a\u4e0d\u9700\u8981 rerender \u7684\u90e8\u5206\u505a\u4f4d\u7f6e\u4e0a\u7684\u8abf\u6574\uff0c\u4f86\u89e3\u6c7a rerender \u7684\u554f\u984c\uff0c\u5982\u679c\u9084\u662f\u7121\u6cd5\u89e3\u6c7a\u7684\u8a71\uff0c\u518d\u7528 memo \u53bb\u8655\u7406\uff01")),(0,o.kt)("h4",{id:"usecallback"},(0,o.kt)("inlineCode",{parentName:"h4"},"useCallback")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useCallback"),"\u6703\u56de\u50b3\u4e00\u500b memoized \u7684 ",(0,o.kt)("strong",{parentName:"p"},"function"),"\uff0c\u901a\u5e38\u6703\u88ab\u4f7f\u7528\u5728\u6709\u5927\u91cf\u8a08\u7b97\u7684 function \u4e0a\u3002\u8ddf useMemo \u4e00\u6a23\uff0c\u4ed6\u4e5f\u662f\u53ea\u6703\u5728\u7b2c\u4e8c\u500b\u503c\u88ab\u6539\u8b8a\u6642\uff0c\u6574\u500b function \u624d\u6703\u57f7\u884c\u3002\u4e0d\u4e00\u6a23\u7684\u5730\u65b9\u662f useMemo \u56de\u50b3\u7684\u662f\u503c\uff0c\u800c useCallback \u56de\u50b3\u7684\u662f function\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const addTodo = useCallback(() => {\n  setTodos((t) => [...t, "New Todo"]);\n}, [todos]);\n')),(0,o.kt)("p",null,"\u7d71\u6574\u4e00\u4e0b\uff0c\u9019\u4e09\u8005\u7684\u5dee\u5225\u662f useMemo \u6703\u56de\u50b3 memoized \u7684\u4e00\u500b\u503c\uff0cuseCallback \u6703\u56de\u50b3 memoized \u7684 function \u7136\u5f8c React.memo \u6703\u56de\u50b3 memoized \u7684 component!\n\u4ecb\u7d39\u5b8c useMemo, React.memo \u548c useCallback \u4e4b\u5f8c\uff0c\u4e0b\u9762\u6211\u5011\u6703\u7e7c\u7e8c\u53bb\u8a0e\u8ad6\u5169\u500b\u5f88\u5be6\u7528\u4e14\u5e38\u5e38\u5728\u9762\u8a66\u4e2d\u88ab\u63d0\u51fa\u4f86\u7684\u554f\u984c---debounce \u548c throttle\u3002"),(0,o.kt)("h3",{id:"debounce"},"debounce"),(0,o.kt)("p",null,"debounce \u53ef\u4ee5\u7528\u5728 input searchBox \u4f86\u907f\u514d\u6bcf\u6b21\u4f7f\u7528\u8005\u6253\u5b57\u90fd\u66f4\u6539 state\uff0c\u9020\u6210 re-render\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//debounce\u5be6\u4f5c\nfunction debounce(func, delay) {\n  let timeout = null;\n  return function (...args) {\n    let context = this;\n    //\u7d81\u5b9a\u5728\u50b3\u9032\u4f86\u7684func\u4e0a\n    clearTimeout(timeout);\n    //\u6e05\u9664\u6389\u524d\u4e00\u500btimeout\n\n    timeout = setTimeout(function () {\n      func.apply(context, args);\n    }, delay);\n  };\n}\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://codesandbox.io/s/vibrant-https-h3c51i?file=/src/index.js:293-405"},"\u7bc4\u4f8b\u770b\u9019\u88e1")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//useDebounce\nfunction useDebounce(value, delay) {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    const timer = setTimeout(() => setDebouncedValue(value), delay || 500);\n\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://codesandbox.io/s/ecstatic-varahamihira-0u4q8f?file=/src/useDebounce.jsx"},"\u7bc4\u4f8b")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://webdesign.tutsplus.com/tutorials/javascript-debounce-and-throttle--cms-36783"},"https://webdesign.tutsplus.com/tutorials/javascript-debounce-and-throttle--cms-36783"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://blog.bitsrc.io/what-is-debounce-in-javascript-a2b8e6157a5a"},"https://blog.bitsrc.io/what-is-debounce-in-javascript-a2b8e6157a5a")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"throttle"},"throttle"),(0,o.kt)("p",null,"throttle \u53ef\u4ee5\u7528\u5728\u756b\u9762 scrolling \u6642\u900f\u904e throttle \u4f86\u907f\u514d\u4e00\u6b21\u5927\u91cf scroll event"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//throttle\u5be6\u4f5c\n//\u7528function\u5beb\nfunction throttle(func, delay) {\n  let inThrottle;\n  let timeout = null;\n  return function (...args) {\n    let context = this;\n    if (!inThrottle) {\n      func.apply(context, args);\n      inThrottle = true;\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        inThrottle = false;\n      }, delay);\n    }\n  };\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//useThrottle\nfunction useThrottle(cb, time = 500) {\n  const isEnableRef = useRef(true);\n\n  return (...args) => {\n    if (!isEnableRef.current) {\n      return;\n    }\n    isEnableRef.current = false;\n\n    cb(...args);\n    setTimeout(() => {\n      isEnableRef.current = true;\n    }, time);\n  };\n}\n")),(0,o.kt)("p",null,"\u9762\u8a66\u984c\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"react \u512a\u5316\u65b9\u6cd5"),(0,o.kt)("li",{parentName:"ol"},"\u4e09\u8005\u7684\u5dee\u5225 useMemo, React.memo \u548c useCallback\uff1f"),(0,o.kt)("li",{parentName:"ol"},"debounce \u5be6\u4f5c\uff1f"),(0,o.kt)("li",{parentName:"ol"},"throttle \u5be6\u4f5c\uff1f")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://ithelp.ithome.com.tw/articles/10222749"},"https://ithelp.ithome.com.tw/articles/10222749"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://www.w3schools.com/react/react_usememo.asp"},"https://www.w3schools.com/react/react_usememo.asp")))}m.isMDXComponent=!0}}]);